{
  "hash": "93db9058ebba19f435595ac39aed8d60",
  "result": {
    "markdown": "---\ntitle: \"Example analysis\"\nbibliography: Bib_for_Project_FeederWatch.bib\ncsl: nature.csl\n---\n\n::: {.cell}\n\n:::\n\n\n![The dark-eyed junco was the most commonly observed species in Project FeederWatch in winter 2020-21. <br> Photo credit: Bob Vuxinic, submitted to Project FeederWatch](dark_eyed_junco_ProjectFeederwatch.png){width=\"50%\"}\n\n### Project aims\n\nIn this example analysis, I investigate patterns in abundance and distribution of birds in the 2020-21 winter in the United States and southern Canada.\nSpecifically, I aim to answer the following questions:\n\n-   when and where are birds observed\n-   which species are most common, and where are they found\n-   which species tend to occur in large flocks, and where are they found\n\nThis analysis is intended for the general public, as well as the citizen scientists (and the graders for Biostat 777).\n\n### Data from Project FeederWatch\n\nThese data were discovered via [TidyTuesday for January 1, 2023](https://github.com/rfordatascience/tidytuesday/tree/master/data/2023/2023-01-10), but originally come from [Project FeederWatch](https://feederwatch.org/).\nProject FeederWatch is a citizen science project that aims to engage individuals in North America to count birds (for as long or as little as they like) to track winter trends in bird distribution and abundance.\nThis project has been running for more than 30 years at this point!\n@Bonter_and_Greig_2021_Proj_FeederWatch The data dictionary is available [here](https://drive.google.com/file/d/1kHmx2XhA2MJtEyTNMpwqTQEnoa9M7Il2/view).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load data and do quick exploration/clean-up\n\n# List required files to download from TidyTuesday\nrds_files <- c(\"feederwatch.RDS\",\"site_data.RDS\")\n\n# Check if any of these files don't exist\nif (any(!file.exists(here(\"data\", rds_files)))) {\n  dir.create(here(\"data\"))\n# if missing, download the data\nfeederwatch <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-01-10/PFW_2021_public.csv')\nsite_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-01-10/PFW_count_site_data_public_2021.csv')\n\n# save the data objects as RDS files\nsaveRDS(feederwatch, file = here(\"data\",\"feederwatch.RDS\"))\nsaveRDS(site_data, file = here(\"data\",\"site_data.RDS\"))\n}\n\n# Load data\nfeederwatch <- readRDS(here(\"data\",\"feederwatch.RDS\"))\nfeederwatch_og <- feederwatch\nsite_data <- readRDS(here(\"data\",\"site_data.RDS\"))\nsite_data_og <- site_data\n# had to save the species_codes dictionary manually from https://docs.google.com/spreadsheets/d/1kHmx2XhA2MJtEyTNMpwqTQEnoa9M7Il2/edit#gid=2040245914\nspecies_codes_dd <- read_csv(here(\"data\",\"FeederWatch_Data_Dictionary_Species_Codes.csv\"),skip = 1)\n\n\n# Quick data exploration, clean up, and creation of a few useful data frames \n# glimpse(feederwatch)\n# summary(feederwatch)\n#length(unique(feederwatch$species_code))\n\n# Change format for names in data dictionary:\nspecies_codes_dd$PRIMARY_COM_NAME <- str_to_title(species_codes_dd$PRIMARY_COM_NAME)\n\n# Check for outliers in space\nlow_lat <- which(feederwatch$latitude<0)   # length=1; this point appears to be erroneous - remove it below\nhigh_lat <- which(feederwatch$latitude>50) # these are not erroneous, but want to narrow to US for plotting later on\n\n# Get rid of the one low-latitude observation\nfeederwatch <- feederwatch[-low_lat,]\n# hist(feederwatch$latitude)\n\n# Add latitudinal bands to the data\nfeederwatch_df <- feederwatch %>%\n  mutate(Date = ymd(paste(Year, Month, Day, sep=\"-\")),\n         lat_band = case_when(\n           latitude < 35 ~ \"low\",\n           latitude >=35 & latitude < 45 ~ \"mid\",\n           latitude >= 45 ~ \"high\"\n         )) \nfeederwatch_df$lat_band <- factor(feederwatch_df$lat_band, levels=c(\"high\",\"mid\",\"low\"))\n\n# Make useful dataframes:\n# Total bird count per day \nbird_count_per_day <- feederwatch_df %>%\n  group_by(Date, \n           lat_band) %>%\n  summarize(total = sum(how_many),\n            count = n(),\n            std_total = total/count)\n\n# Abundant birds: birds that have highest counts in the dataset - i.e. flocking birds\nabundant_birds <- feederwatch_df %>%\n  filter(latitude<50) %>%\n  group_by(species_code) %>%\n  summarize(total = sum(how_many),\n            count = n(),\n            std_total = total/count) %>%\n  arrange(desc(std_total)) %>%\n  head(n=9) %>%\n  left_join(species_codes_dd, \n            by=join_by(species_code==SPECIES_CODE)) %>%\n  select(species_code, \n         PRIMARY_COM_NAME, \n         SCI_NAME, count)\n\n# join with species info:\nabundant_birds_df <- feederwatch_df %>%\n   filter(species_code %in% abundant_birds$species_code) %>%\n   left_join(species_codes_dd, \n             by=join_by(species_code==SPECIES_CODE)) %>%\n   mutate(Month=factor(Month, levels=c(\"11\",\"12\",\"1\",\"2\",\"3\",\"4\")))\n\n\n# Common birds: birds that have several records in the dataset\ncommonly_sighted_birds <- feederwatch_df %>%\n  group_by(species_code) %>%\n  summarize(total = sum(how_many),\n            count = n(),\n            std_total = total/count) %>%\n  arrange(desc(count)) %>%\n  head(n=9) %>%\n  left_join(species_codes_dd, \n            by=join_by(species_code==SPECIES_CODE)) %>%\n  select(species_code, \n         PRIMARY_COM_NAME, \n         SCI_NAME, \n         count)\n\n# join with species info:\ncommonly_sighted_birds_df <- feederwatch_df %>%\n   filter(species_code %in% commonly_sighted_birds$species_code) %>%\n   left_join(species_codes_dd, \n             by=join_by(species_code==SPECIES_CODE)) %>%\n   mutate(Month=factor(Month, levels=c(\"11\",\"12\",\"1\",\"2\",\"3\",\"4\")))\n```\n:::\n\n\n\n### Where are birds observed?\n\nIn order to understand trends in bird distribution and abundance, we first need to know where our observations are coming from.\nHere is a figure showing the locations of observations.\nThe points are transparent, so denser bird-watching areas are shaded darker green.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 1: Map of unique sighting locations\n\n# Prep maps of America/USA for making figures\namerica_map <- map_data(\"world\", region='USA')\nUSA_map <-\n  ggplot(america_map, \n         aes(x=long, y=lat, group=group)) +\n  geom_polygon(fill=\"white\",color=\"black\") + \n  scale_x_continuous(limits = c(-125,-65)) +\n  scale_y_continuous(limits = c(25, 50)) + \n  coord_map() +\n  theme_minimal()\n\n# Identify unique sighting locations\nunique_sighting_locations <- feederwatch %>%\n  group_by(loc_id) %>%\n  summarize(n_obs = n(),\n            latitude=mean(latitude),\n            longitude=mean(longitude))\n\n# Plot unique sighting locations\nUSA_map +\n  geom_point(data=unique_sighting_locations, \n             aes(x = longitude, y = latitude, group=NULL), \n             alpha=0.1, \n             color=\"darkgreen\") +\n  labs(x=\"Longitude (ºE)\", \n       y = \"Latitude (ºN)\", \n       title = \"Observing locations for 2020-21 winter in US and southern Canada\",\n       subtitle = \"Engagement in Project Feederwatch is stronger in the eastern than the western U.S., \\nand the highest density of birdwatchers are in the mid-Atlantic to Northeast regions.\",\n       caption = \"Data: Project FeederWatch\")\n```\n\n::: {.cell-output-display}\n![Observing locations for Project FeederWatch 2020-21 winter.](analysis_files/figure-html/fig-obs-loc-1.png){#fig-obs-loc width=672}\n:::\n:::\n\n\n::: {.callout-tip title=\"Birdwatching locations\"}\nParticipants can birdwatch anywhere -- it doesn't have to be at their backyard feeder!\nBut remember the distribution of observing locations in this figure since it will be relevant for understanding the distribution of common and flocking birds examined below.\n:::\n\nSince most bird-watching happens in the mid-latitudes (defined here as 35-45ºN), we must standardize the number of birds by the number of observations.\nThe following figure indicates that birds are more abundant at higher latitudes even though there are fewer total observations.\nHowever, birds become more common at lower latitudes (\\<35ºN) from January to March.\nThis may be explained by migration to southern regions during the coldest months of the year.\nThe fact that more birds are reported within every latitudinal band during the coldest months may indicate that more birds visit feeders to obtain food during the harshest conditions of the year.\n\n### \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 2: Bird count per latitude band\nbird_count_per_day %>%\n  ggplot(aes(x=Date, y = std_total, color = lat_band)) +   \n  geom_smooth() +   # loess-smoother is default\n  theme_minimal() +   \n  labs(y = \"Average number of birds per observation\", \n       title = \"Birds observed per latitude band during 2020-21 winter\", \n       color = \"Latitude band\", \n       subtitle = \"Birds are most abundant at high latitudes, but become relatively \\nmore frequent in low latitudes in the winter\", \n       caption = \"Data: Project FeederWatch\")\n```\n\n::: {.cell-output-display}\n![Total number of birds observed within each latitudinal band (high: >=45ºN, mid: 35-45ºN, low: <35ºN).](analysis_files/figure-html/fig-lat-band-1.png){#fig-lat-band width=672}\n:::\n:::\n\n\n::: column-margin\nLOESS (locally weighted running line smoother) was used on these curves.\nThis is the default option for geom_smooth.\n:::\n\n### \n\nLet's now explore how often different species are observed.\nA total of 361 unique species were reported, but most of these species were only observed once!\nHowever, the most common species were observed thousands of times!\nThis is probably explained in part because birds are incredibly diverse, @Bird_diversity so some of these species may actually be rare, while others have may have limited distributions or be harder to identify.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 3: Histogram of bird observations per species\nfeederwatch_df %>%\n  group_by(species_code) %>%\n  summarize(n_obs = n()) %>%\n  ggplot() +\n  geom_histogram(aes(n_obs), \n                 boundary=0, \n                 closed=\"left\") +\n  labs(x = \"Number of observations for a given species\", \n       y = \"Frequency\", \n       title = \"Number of observations per bird species\",\n       subtitle = \"Most bird species are only observed once. A few common species are observed \\nthousands of times.\",\n       caption = \"Data: ProjectFeederwatch\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Histogram of the number of observations per species.](analysis_files/figure-html/fig-hist-obs-1.png){#fig-hist-obs width=672}\n:::\n:::\n\n\n::: {.callout-warning title=\"Rare birds are becoming rarer\"}\nIn 2019, the National Audubon Society estimated that two-thirds of North American birds were at risk of extinction due to climate change.\n@audobon_bird_extinction\n:::\n\n### Which birds are most common?\n\nYou'll probably recognize the names of some of the most common birds!\nThese birds were identified as \"common\" in the data set because they had the most observations (though not necessarily the highest total count of individuals).\n\n\n::: {.cell caption='Most commonly observed birds in the 2020-21 winter in Project FeederWatch.'}\n\n```{.r .cell-code}\n# Table 1\ncommonly_sighted_birds_table <- commonly_sighted_birds %>%\n  select('Common name' = PRIMARY_COM_NAME,\n         'Scientific name' = SCI_NAME,\n         'Number of observations' = count)\ncommonly_sighted_birds_table\n```\n\n::: {.cell-output-display}\nTable: Most commonly observed birds in the 2020-21 winter in Project FeederWatch.\n\n|Common name             |Scientific name       | Number of observations|\n|:-----------------------|:---------------------|----------------------:|\n|Dark-Eyed Junco         |Junco hyemalis        |                   5465|\n|Downy Woodpecker        |Picoides pubescens    |                   5449|\n|Northern Cardinal       |Cardinalis cardinalis |                   5438|\n|House Finch             |Haemorhous mexicanus  |                   4955|\n|Mourning Dove           |Zenaida macroura      |                   4938|\n|Black-Capped Chickadee  |Poecile atricapillus  |                   4696|\n|Blue Jay                |Cyanocitta cristata   |                   4578|\n|American Goldfinch      |Spinus tristis        |                   4446|\n|White-Breasted Nuthatch |Sitta carolinensis    |                   4393|\n:::\n:::\n\n\nMost of the common birds were observed throughout the U.S. (or at least where people were reportedly birdwatching, see @fig-obs-loc).\nHowever, some birds had more limited distributions.\nFor example, the blue jay and the northern cardinal were found predominantly in the eastern half of the U.S., and the black-capped chickadee was only observed in the more northern latitudes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 4: Commonly sighted birds\n# Since this figure takes a long time to render, we'll just load in the saved figure below, but this is the code that was used to generate it:\n  \ncommon_birds_plot <- USA_map +\n  geom_bin_2d(data = commonly_sighted_birds_df, \n              aes(x = longitude, y = latitude, group=NULL)) +\n  scale_fill_continuous(low=\"lightskyblue1\", \n                        high=\"indianred4\", \n                        name=\"Number of \\nsightings\") +\n  theme_minimal() + \n  labs(x=\"Longitude (E)\", \n       y=\"Latitude (N)\", \n       title=\"Observations of common birds in the US and southern Canada\", \n       subtitle=\"Common bird species are most frequently observed in the Mid-Atlantic and \\nNortheast regions, likely due (in part) to a sampling bias and easy bird identification\", \n       color=\"Month\") + \n  facet_wrap(vars(PRIMARY_COM_NAME), \n             labeller = labeller(PRIMARY_COM_NAME = label_wrap_gen(width = 10)))\n#ggsave(here(\"figs\",\"Commonly_sighted_birds.png\"), plot=common_birds_plot, width=7, height=7, units=\"in\")\n```\n:::\n\n\n::: {#fig-common fig-cap=\"Heatmap of observations for the most common birds.\"}\n![](./figs/Commonly_sighted_birds.png){width=\"75%\"}\n:::\n\n### Which birds are usually found in a flock?\n\nHave you heard the saying that \"birds of a feather flock together\"?\nThe birds in the figure below had the highest average abundance per observation.\nThis indicates to me that these birds tend to appear most often in large flocks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 5: Most abundant birds (i.e. probably largest flocks)\n# focus on birds in US (or below 50oN):\nmonth_colors = c(\"sandybrown\",\"indianred\",\"slateblue3\",\"royalblue\",\"palegreen3\")\n\nUSA_map +\n  geom_point(data = abundant_birds_df, \n             aes(x = longitude, y = latitude, group=NULL, size=how_many, color=Month), \n             alpha=0.5) +\n  scale_color_manual(values=month_colors) +   \n  theme_minimal() + \n  labs(x=\"Longitude (E)\", \n       y=\"Latitude (N)\", \n       title=\"Flocking birds observed in the US and southern Canada\", \n       subtitle=\"Birds with the highest average count per observation \\ntend to have limited distributions\", \n       caption = \"Data: Project FeederWatch\",\n       size=\"Count per observation\") +\n  facet_wrap(vars(PRIMARY_COM_NAME), \n             labeller = labeller(PRIMARY_COM_NAME = label_wrap_gen(width = 10)))\n```\n\n::: {.cell-output-display}\n![Month and location for bird species with the largest average count per observation. The size of the circle is relative to the flock size, and the color indicates the month when the observation was made.](analysis_files/figure-html/fig-flock-1.png){#fig-flock width=672}\n:::\n:::\n\n\n### Summary\n\nIn this example analysis, we explored patterns in the distribution and abundance of birds observed through the citizen science initiative Project FeederWatch conducted in winter 2020-21.\nWe found that most of the observations for this program were made in the mid-Atlantic and northeast regions of the U.S.\nThis pattern of observation corresponded strongly with the distribution of several of the most common birds, including the American goldfinch, dark-eyed junco, downy woodpecker, and house finch.\nHowever, flocking birds tended to have smaller ranges but a larger number of birds reported per observation.\nIn general, birds were most abundant in the coldest months (January-March) and at the highest latitudes (\\>45ºN).\n\n### Functions used\n\ndplyr: mutate, group_by, summarize, arrange, filter\\\nggplot2: geom_smooth, geom_histogram, geom_polygon, geom_bin_2d, geom_point, facet_wrap\n",
    "supporting": [
      "analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}